# ğŸ·ï¸ í…Œë§ˆ ì¶”ì¶œ ì‹œìŠ¤í…œ (Theme Extraction System)

> **ì†ŒìŠ¤ íŒŒì¼**: `kr_market/engine/llm_analyzer.py`, `generator.py`, `page.tsx`  
> **ìµœì¢… ì—…ë°ì´íŠ¸**: 2026-01-23  
> **ë²„ì „**: v2.0

---

## ğŸ“Š Overview

ì¢…ê°€ë² íŒ… V2ì—ì„œ **LLM ê¸°ë°˜ í…Œë§ˆ ì¶”ì¶œ**ì€ ì£¼ì‹ ë‰´ìŠ¤ë¥¼ ë¶„ì„í•˜ì—¬ í•´ë‹¹ ì¢…ëª©ì˜ íˆ¬ì í…Œë§ˆë¥¼ ìë™ìœ¼ë¡œ íƒœê¹…í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

```mermaid
flowchart LR
    subgraph Input
        N[ë‰´ìŠ¤ ìˆ˜ì§‘]
    end
    
    subgraph LLM["LLM ë¶„ì„ (Gemini 3.0)"]
        P[Perplexity ê²€ìƒ‰] --> G[Gemini ë¶„ì„]
        G --> T[í…Œë§ˆ ì¶”ì¶œ]
        G --> S[í˜¸ì¬ ì ìˆ˜]
    end
    
    subgraph Output
        T --> DB[(Signal ì €ì¥)]
        DB --> UI[í”„ë¡ íŠ¸ì—”ë“œ í‘œì‹œ]
        DB --> CL[í…Œë§ˆ í´ë¼ìš°ë“œ]
    end
    
    N --> P
```

---

## ğŸ¤– 1. ë°±ì—”ë“œ: LLM í”„ë¡¬í”„íŠ¸ ì„¤ê³„

### ìœ„ì¹˜: `kr_market/engine/llm_analyzer.py`

### Gemini í”„ë¡¬í”„íŠ¸ (í…Œë§ˆ ì¶”ì¶œ ë¶€ë¶„)

```python
prompt = f"""
ë‹¹ì‹ ì€ ì£¼ì‹ íˆ¬ì ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ë‹¤ìŒì€ '{ì¢…ëª©ëª…}' ì¢…ëª©ì— ëŒ€í•œ ë‰´ìŠ¤ì…ë‹ˆë‹¤.

{ë‰´ìŠ¤ ë‚´ìš©}

ìœ„ ì •ë³´ë¥¼ ë¶„ì„í•˜ì—¬:
1. í˜¸ì¬ ê°•ë„ë¥¼ 0~3ì ìœ¼ë¡œ í‰ê°€
2. í•µì‹¬ íˆ¬ì í…Œë§ˆë¥¼ ì¶”ì¶œ (1~3ê°œ)

[í…Œë§ˆ ì˜ˆì‹œ]
ë¡œë´‡, AIë°˜ë„ì²´, 2ì°¨ì „ì§€, ë°©ì‚°, ìš°ì£¼í•­ê³µ, ë°”ì´ì˜¤, 
ê·¸ë£¹ì¬í¸, M&A, HBM, ì „ë ¥ë°˜ë„ì²´, íƒœì–‘ê´‘ ë“±

[ì¶œë ¥ í˜•ì‹]
{{"score": 2, "reason": "í‰ê°€ ì´ìœ ", "themes": ["í…Œë§ˆ1", "í…Œë§ˆ2"]}}
"""
```

### ë°˜í™˜ êµ¬ì¡°

```python
{
    "score": 2,              # 0~3 í˜¸ì¬ ì ìˆ˜
    "reason": "ë¶„ì„ ìš”ì•½",   # AI ë¶„ì„ ì½”ë©˜íŠ¸
    "themes": ["AIë°˜ë„ì²´", "HBM"],  # ì¶”ì¶œëœ í…Œë§ˆ ë¦¬ìŠ¤íŠ¸
    "citations": [...],      # Perplexity ì¶œì²˜ URL
    "source": "perplexity+gemini"
}
```

---

## ğŸ“¦ 2. Signal ëª¨ë¸ í™•ì¥

### ìœ„ì¹˜: `kr_market/engine/models.py`

```python
from dataclasses import dataclass, field
from typing import List

@dataclass
class Signal:
    stock_code: str
    stock_name: str
    grade: str
    score: ScoreDetail
    # ... ê¸°ì¡´ í•„ë“œë“¤ ...
    
    themes: List[str] = field(default_factory=list)  # ğŸ†• í…Œë§ˆ í•„ë“œ
    
    def to_dict(self):
        return {
            # ... ê¸°ì¡´ í•„ë“œë“¤ ...
            "themes": self.themes,
        }
```

---

## âš™ï¸ 3. Generator ì—°ê²°

### ìœ„ì¹˜: `kr_market/engine/generator.py` (Line 206)

```python
async def _analyze_stock(self, stock, target_date):
    # 1. ë‰´ìŠ¤ ìˆ˜ì§‘
    news_list = await self._news.get_stock_news(stock.code, 3, stock.name)
    
    # 2. LLM ë¶„ì„ (Perplexity + Gemini)
    llm_result = await self.llm_analyzer.analyze_news_sentiment(
        stock.name, 
        news_dicts
    )
    
    # 3. ì‹œê·¸ë„ ìƒì„± ì‹œ í…Œë§ˆ í¬í•¨
    signal = Signal(
        stock_code=stock.code,
        stock_name=stock.name,
        # ... ê¸°ì¡´ í•„ë“œë“¤ ...
        themes=llm_result.get("themes", []) if llm_result else [],  # ğŸ†•
    )
```

---

## ğŸ¨ 4. í”„ë¡ íŠ¸ì—”ë“œ UI

### ìœ„ì¹˜: `frontend/src/app/dashboard/kr/closing-bet/page.tsx`

### 4.1 Signal ì¸í„°í˜ì´ìŠ¤

```typescript
interface Signal {
    stock_code: string;
    stock_name: string;
    grade: string;
    themes?: string[];  // ğŸ†• LLM ì¶”ì¶œ í…Œë§ˆ
    // ...
}
```

### 4.2 ê°œë³„ ì‹œê·¸ë„ ì¹´ë“œ - í…Œë§ˆ íƒœê·¸ í‘œì‹œ

```tsx
{/* í…Œë§ˆ íƒœê·¸ í‘œì‹œ */}
{signal.themes && signal.themes.length > 0 && signal.themes.map((theme, i) => (
    <span 
        key={i} 
        className="px-2 py-1 rounded 
                   bg-violet-500/10 border border-violet-500/20 
                   text-violet-400 text-[10px]"
    >
        {theme}
    </span>
))}
```

### 4.3 Theme Cloud Widget (í—¤ë” ì˜ì—­)

í…Œë§ˆ ë¹ˆë„ë¥¼ ë¶„ì„í•˜ì—¬ ì›Œë“œ í´ë¼ìš°ë“œ í˜•íƒœë¡œ í‘œì‹œ:

```tsx
function ThemeCloudWidget({ signals }: { signals: Signal[] }) {
    // 1. í…Œë§ˆ ë¹ˆë„ ì§‘ê³„
    const themeCounts: Record<string, number> = {};
    signals.forEach(s => {
        if (s.themes) {
            s.themes.forEach(t => {
                themeCounts[t] = (themeCounts[t] || 0) + 1;
            });
        }
    });

    // 2. ìƒìœ„ 15ê°œ ì¶”ì¶œ
    const sortedThemes = Object.entries(themeCounts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 15);

    // 3. ê°€ì¤‘ì¹˜ ê¸°ë°˜ í¬ê¸° ê³„ì‚°
    const maxCount = sortedThemes[0][1];
    const minCount = sortedThemes[sortedThemes.length - 1][1];

    return (
        <div className="flex flex-wrap gap-3">
            {sortedThemes.map(([theme, count]) => {
                const weight = (count - minCount) / (maxCount - minCount);
                
                // ê°€ì¤‘ì¹˜ì— ë”°ë¥¸ í°íŠ¸ í¬ê¸°
                let fontSize = 'text-xs';
                if (weight > 0.8) fontSize = 'text-2xl font-bold';
                else if (weight > 0.5) fontSize = 'text-lg font-bold';
                else if (weight > 0.3) fontSize = 'text-sm font-semibold';
                
                return (
                    <span 
                        key={theme} 
                        className={`${fontSize} bg-clip-text text-transparent 
                                    bg-gradient-to-r from-cyan-400 to-blue-500`}
                    >
                        {theme}
                    </span>
                );
            })}
        </div>
    );
}
```

### 4.4 ë””ìì¸ ìŠ¤í™

| ìš”ì†Œ | ìŠ¤íƒ€ì¼ |
|------|--------|
| **ê°œë³„ íƒœê·¸** | `bg-violet-500/10`, `text-violet-400`, 10px |
| **í´ë¼ìš°ë“œ ë°°ê²½** | Glassmorphism (`backdrop-blur-md`) |
| **í˜¸ë²„ íš¨ê³¼** | `scale-110`, `rotate-1` íŠ¸ëœì§€ì…˜ |
| **ê·¸ë¼ë°ì´ì…˜** | Cyber Blue, Neon Purple, Sunset ë“± 6ì¢… |

---

## ğŸ“ˆ 5. ë°ì´í„° íë¦„ ì „ì²´ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ì¢…ê°€ë² íŒ… V2 ì—”ì§„                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  [1] Collector                                              â”‚
â”‚      â””â”€â†’ ìƒìŠ¹ë¥  TOP 30 ì¢…ëª© ì¶”ì¶œ                             â”‚
â”‚                                                             â”‚
â”‚  [2] News Collector                                         â”‚
â”‚      â””â”€â†’ ë„¤ì´ë²„ ê¸ˆìœµ ë‰´ìŠ¤ í¬ë¡¤ë§                             â”‚
â”‚                                                             â”‚
â”‚  [3] LLM Analyzer                                           â”‚
â”‚      â”œâ”€â†’ Perplexity: ì‹¤ì‹œê°„ ì›¹ ê²€ìƒ‰ (24h)                   â”‚
â”‚      â””â”€â†’ Gemini 3.0: ë‰´ìŠ¤ ë¶„ì„ + í…Œë§ˆ ì¶”ì¶œ                  â”‚
â”‚              â”‚                                              â”‚
â”‚              â”œâ”€â†’ score: 0~3 (í˜¸ì¬ ì ìˆ˜)                     â”‚
â”‚              â”œâ”€â†’ reason: "AI ë¶„ì„ ìš”ì•½"                     â”‚
â”‚              â””â”€â†’ themes: ["AIë°˜ë„ì²´", "HBM"]  â† ğŸ†•          â”‚
â”‚                                                             â”‚
â”‚  [4] Signal Generator                                       â”‚
â”‚      â””â”€â†’ Signal ê°ì²´ ìƒì„± (themes í•„ë“œ í¬í•¨)                â”‚
â”‚                                                             â”‚
â”‚  [5] JSON ì €ì¥                                              â”‚
â”‚      â””â”€â†’ data/jongga_v2_latest.json                        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Flask API                              â”‚
â”‚                                                             â”‚
â”‚  GET /api/kr/jongga-v2/latest                              â”‚
â”‚      â””â”€â†’ signals[].themes í¬í•¨í•˜ì—¬ ë°˜í™˜                     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Frontend (Next.js)                        â”‚
â”‚                                                             â”‚
â”‚  [1] ThemeCloudWidget (í—¤ë”)                               â”‚
â”‚      â””â”€â†’ í…Œë§ˆ ë¹ˆë„ ê¸°ë°˜ ì›Œë“œ í´ë¼ìš°ë“œ                        â”‚
â”‚                                                             â”‚
â”‚  [2] SignalCard (ê°œë³„ ì¹´ë“œ)                                â”‚
â”‚      â””â”€â†’ í…Œë§ˆ íƒœê·¸ (ë°”ì´ì˜¬ë › ìƒ‰ìƒ)                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ·ï¸ 6. í…Œë§ˆ ì˜ˆì‹œ

| ì¢…ëª© | ì¶”ì¶œëœ í…Œë§ˆ |
|------|------------|
| ì‚¼ì„±ì „ì | HBM, AIë°˜ë„ì²´ |
| í•œì „ê¸°ìˆ  | ì›ì „, ì‹¤ì ê°œì„  |
| ë‰´ë¡œë©”ì¹´ | ë¡œë´‡, í˜‘ë™ë¡œë´‡ |
| í¬ìŠ¤ì½”DX | SI, AI, ìŠ¤ë§ˆíŠ¸íŒ©í† ë¦¬ |
| ëŒ€í•œí•­ê³µ | í•­ê³µ, ì–´ë‹ì„œí”„ë¼ì´ì¦ˆ |
| ì—ì½”í”„ë¡œ | 2ì°¨ì „ì§€, ì–‘ê·¹ì¬ |
| í•œí™”ì—ì–´ë¡œìŠ¤í˜ì´ìŠ¤ | ë°©ì‚°, ìš°ì£¼í•­ê³µ |

### ìì£¼ ë“±ì¥í•˜ëŠ” í…Œë§ˆ ì¹´í…Œê³ ë¦¬

| ì¹´í…Œê³ ë¦¬ | í…Œë§ˆ ì˜ˆì‹œ |
|----------|----------|
| **ë°˜ë„ì²´** | AIë°˜ë„ì²´, HBM, ì „ë ¥ë°˜ë„ì²´, íŒŒìš´ë“œë¦¬ |
| **ë¯¸ë˜ì‚°ì—…** | ë¡œë´‡, ììœ¨ì£¼í–‰, ë©”íƒ€ë²„ìŠ¤, ìš°ì£¼í•­ê³µ |
| **ì—ë„ˆì§€** | 2ì°¨ì „ì§€, íƒœì–‘ê´‘, ì›ì „, SMR |
| **ë°”ì´ì˜¤** | ì‹ ì•½, ì„ìƒ, FDAìŠ¹ì¸, ì§„ë‹¨í‚¤íŠ¸ |
| **ì´ë²¤íŠ¸** | M&A, ê·¸ë£¹ì¬í¸, ì‹¤ì ê°œì„ , ì–´ë‹ì„œí”„ë¼ì´ì¦ˆ |
| **ì •ì±…** | ë°©ì‚°, ê±´ì„¤, ì¡°ì„  |

---

## âš ï¸ 7. ì™œ LLM ê¸°ë°˜ì„ ì„ íƒí–ˆë‚˜?

| ë°©ì‹ | ì¥ì  | ë‹¨ì  | ì±„íƒ |
|------|------|------|------|
| ë„¤ì´ë²„ í…Œë§ˆ í¬ë¡¤ë§ | ê³µì‹ í…Œë§ˆ | iframe êµ¬ì¡°ë¡œ í¬ë¡¤ë§ ì–´ë ¤ì›€ | âŒ |
| ì—…ì¢…(Sector) ë¶„ë¥˜ | ì•ˆì •ì  | ë™ì ì¸ í…Œë§ˆ ë°˜ì˜ ë¶ˆê°€ | âŒ |
| **LLM ë‰´ìŠ¤ ê¸°ë°˜ ì¶”ì¶œ** | ì‹¤ì‹œê°„, ë™ì , ì •í™• | API ë¹„ìš© | âœ… |

> LLMì´ ì´ë¯¸ ë‰´ìŠ¤ ë¶„ì„(í˜¸ì¬ ì ìˆ˜)ì„ ìˆ˜í–‰í•˜ê³  ìˆìœ¼ë¯€ë¡œ, **ì¶”ê°€ ë¹„ìš© ì—†ì´** í…Œë§ˆë„ í•¨ê»˜ ì¶”ì¶œí•˜ëŠ” ê²ƒì´ íš¨ìœ¨ì .

---

## ğŸ“ 8. ë³€ê²½ íŒŒì¼ ëª©ë¡

| íŒŒì¼ | ë³€ê²½ ë‚´ìš© |
|------|----------|
| `kr_market/engine/llm_analyzer.py` | í”„ë¡¬í”„íŠ¸ì— í…Œë§ˆ ì¶”ì¶œ ê°€ì´ë“œ ì¶”ê°€ |
| `kr_market/engine/models.py` | Signal í´ë˜ìŠ¤ì— `themes` í•„ë“œ ì¶”ê°€ |
| `kr_market/engine/generator.py` | LLM ê²°ê³¼ì—ì„œ themes ì¶”ì¶œí•˜ì—¬ Signalì— ì—°ê²° |
| `frontend/.../closing-bet/page.tsx` | í…Œë§ˆ íƒœê·¸ UI + ThemeCloudWidget |

---

## ğŸ§ª 9. í…ŒìŠ¤íŠ¸ ë°©ë²•

### 9.1 ë‹¨ë… LLM í…ŒìŠ¤íŠ¸

```bash
cd /Users/seoheun/Documents/êµ­ë‚´ì£¼ì‹
python -m kr_market.engine.llm_analyzer
```

### 9.2 ì „ì²´ ìŠ¤í¬ë¦¬ë„ˆ ì‹¤í–‰

```bash
python -m kr_market.engine.generator
```

### 9.3 ì¶œë ¥ í™•ì¸

```bash
cat kr_market/data/jongga_v2_latest.json | jq '.signals[0].themes'
```

ì˜ˆìƒ ì¶œë ¥:
```json
["AIë°˜ë„ì²´", "HBM"]
```

---

> **ì°¸ê³ **: ì´ ë¬¸ì„œëŠ” `llm_analyzer.py`, `generator.py`, `page.tsx` ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
